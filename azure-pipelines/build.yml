trigger:
  - azure_pipelines

jobs:
  - job: Linux
    pool:
      vmImage: ubuntu-16.04

    steps:
      - bash: sudo apt install libvulkan-dev build-essential libevent-pthreads-2.0.5 doxygen xorg-dev libglu1-mesa-dev
        displayName: 'Install dependencies'

      - bash: |
          git clone https://github.com/glfw/glfw.git
          cd glfw
          cmake .
          make
          sudo make install
          cd ..
        displayName: 'Install GLFW from source'

      - bash: ./gradlew build
        displayName: 'Build KGL'

  - job: MacOS
    pool:
      vmImage: macOS-10.14

    steps:
      - bash: brew install glfw --HEAD
        displayName: 'Install GLFW'

      - bash: ./gradlew build
        displayName: 'Build KGL'

  - job: Windows
    pool:
      vmImage: vs2017-win2016

    steps:
      - script: choco install msys2 --params "/InstallDir:c:\msys64"
        displayName: 'Install MSYS2'

      - script: C:\msys64\usr\bin\pacman --noconfirm -S mingw-w64-x86_64-glfw
        displayName: 'Install GLFW'

      - script: gradlew build
        displayName: 'Build KGL'
